(()=>{"use strict";const e=window.React,t=window.wp.i18n,n=window.wc.wcBlocksRegistry,r=window.wp.htmlEntities,a=window.wc.wcSettings,s=window.wp.element,c=({onChange:n,existingCards:r})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h3",null,(0,t.__)("Use an existing card","omise")),(0,e.createElement)("ul",{className:"omise-customer-card-list"},r.map(((t,r)=>(0,e.createElement)("li",{key:t.id,className:"item"},(0,e.createElement)("input",{defaultChecked:0===r,id:`card-${t.id}`,type:"radio",name:"card_id",value:t.id,onChange:n}),(0,e.createElement)("label",{htmlFor:`card-${t.id}`},(0,e.createElement)("strong",null,t.brand)," xxxx ",t.last_digits))))),(0,e.createElement)("input",{id:"new_card_info",type:"radio",name:"card_id",value:"",onChange:n}),(0,e.createElement)("label",{id:"label-new_card_info",htmlFor:"new_card_info"},(0,e.createElement)("h3",null,(0,t.__)("Create a charge using new card","omise")))),i=window.wc.wcBlocksData,l=t=>{const{settings:n}=t,{existing_cards:a,description:l}=n,o=(0,s.useRef)(null),d=(0,s.useRef)(!1),m=(0,s.useRef)(null),u=(0,s.useRef)(null),p=(0,s.useRef)(null),[_,g]=(0,s.useState)(a&&a.length>0),{eventRegistration:E,emitResponse:y}=t,{onPaymentSetup:w,onCheckoutValidation:h}=E;function f(e){const t=document.getElementById("billing-state");return t?.querySelector(`option[value="${e}"]`)?.innerText}return(0,s.useEffect)((()=>{var e;_||showOmiseEmbeddedCardForm({element:o.current,publicKey:n.public_key,hideRememberCard:!n.user_logged_in,locale:n.locale,theme:null!==(e=n.card_form_theme)&&void 0!==e?e:"light",design:n.form_design,brandIcons:n.card_brand_icons,onSuccess:e=>{e.remember&&(d.current=e.remember),m.current=e.token},onError:e=>{p.current=e}})}),[_]),(0,s.useEffect)((()=>{if(!_)return h((()=>{const{select:e}=window.wp.data,{billingAddress:t}=e(i.CART_STORE_KEY).getCartData();return t instanceof Object?OmiseCard.requestCardToken({email:t.email,billingAddress:{street1:t.address_1,street2:t.address_2,city:t.city,country:t.country,state:f(t.state),postal_code:t.postcode,phone_number:t.phone}}):OmiseCard.requestCardToken(),!0}))}),[h,_]),(0,s.useEffect)((()=>{const e=w((async()=>await new Promise(((e,t)=>{const n=setInterval((()=>{if(u.current&&""!==u.current.value){clearInterval(n);try{const t={type:y.responseTypes.SUCCESS,meta:{paymentMethodData:{card_id:u.current.value,wc_block_payment:!0}}};e(t)}catch(e){const n={type:y.responseTypes.ERROR,message:e.message};t(n)}}else if(m.current&&""!==m.current.value){clearInterval(n);try{const t={type:y.responseTypes.SUCCESS,meta:{paymentMethodData:{omise_save_customer_card:d.current,omise_token:m.current,wc_block_payment:!0}}};e(t)}catch(e){const n={type:y.responseTypes.ERROR,message:e.message};t(n)}}else if(p.current){clearInterval(n);const e={type:y.responseTypes.ERROR,message:p.current};t(e)}}),1e3)}))));return()=>e()}),[y.responseTypes.ERROR,y.responseTypes.SUCCESS,w]),(0,e.createElement)(e.Fragment,null,a&&a.length>0&&(0,e.createElement)(c,{existingCards:a,onChange:e=>{const t=e.target;g(""!==t.value),u.current=t}}),!_&&(0,e.createElement)("p",null,(0,r.decodeEntities)(l||"")),(0,e.createElement)("div",{ref:o,id:"omise-card",style:{width:"100%",display:_?"none":"block"}}),!_&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("input",{type:"hidden",name:"omise_save_customer_card",id:"omise_save_customer_card"}),(0,e.createElement)("input",{type:"hidden",className:"omise_token",name:"omise_token"})))},o=(0,a.getSetting)("omise_data",{}),d=(0,t.__)("Credit/Debit card","omise"),m=(0,r.decodeEntities)(o.title)||d;window.OMISE_CUSTOM_FONT_OTHER="Other";const u=t=>(0,e.createElement)(l,{...t,settings:o});(0,n.registerPaymentMethod)({name:o.name||"",label:(0,e.createElement)((t=>{const{PaymentMethodLabel:n}=t.components;return(0,e.createElement)(n,{text:m})}),null),content:(0,e.createElement)(u,{settings:o}),edit:(0,e.createElement)(u,{settings:o}),canMakePayment:()=>o.is_active,ariaLabel:m,supports:{features:o.supports}})})();